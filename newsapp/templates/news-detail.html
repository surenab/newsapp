{% extends 'base_home.html' %}
{% load static %}
{% block bodycontent %}

<section id="posts" class="posts">
    <div class="container" data-aos="fade-up">
        <div class="post-meta"></div>
        <div class="post-meta">Type: {{news.get_news_type_display}}</div>
        <div class="post-meta">Date: {{news.date}}</div>
        <div class="post-meta">Title: {{news.title}}</div>
        <div class="post-meta"><img src="{{news.image.url}}" alt="" class="img-fluid"></div>
        <div class="post-meta">{{news.description}}</div>
        {% if comments %}
        <div>Comments</div>
{% for comment in comments %}
<div class="card-body">
    <div class="d-flex flex-start align-items-center">
        <img class="rounded-circle shadow-1-strong me-3"
            src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(19).webp" alt="avatar" width="60" height="60">
        <div>
            <h6 class="fw-bold text-primary mb-1">{{comment.owner.username}}</h6>
            <p class="text-muted small mb-0">
                {{comment.created_on}}
            </p>
        </div>
    </div>

    <p class="mt-3 mb-4 pb-2">
        {{comment.text}}
    </p>

</div>
{% endfor %}
        {% endif %}

        {% if request.user.is_authenticated %}
        <form action="{% url 'create_comment' %}" method="POST">
            {% csrf_token %}
            <section style="background-color: #eee;">
                <div class="container my-5 py-5">
                  <div class="row d-flex justify-content-center">
                    <div class="col-md-12 col-lg-10 col-xl-8">
                      <div class="card">
                        <div class="card-body">
                          <div class="d-flex flex-start align-items-center">
                          </div>
                        </div>
                        {{comment_form}}
                        <input type="hidden" id="news" value="{{news.id}}" name="news" />
                          <div class="float-end mt-2 pt-1">
                            <button type="submit" class="button-74">Post comment</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
            </section>
            
        </form>
        {%endif%}
    </div>
    
</section> <!-- End Post Grid Section -->

<script>
  // Attach an event listener to the select element
  document.getElementById('blogs_per_page').addEventListener('change', function () {
      // Get the selected value
      var selectedValue = this.value;

      // Build the new URL with the updated query parameter
      var newUrl = updateQueryStringParameter(window.location.pathname, 'blogs_per_page', selectedValue);

      // Redirect to the new URL
      window.location.href = newUrl + window.location.search + window.location.hash;
  });

  // Function to update query string parameter
  function updateQueryStringParameter(uri, key, value) {
      var re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
      var separator = uri.indexOf('?') !== -1 ? "&" : "?";
      if (uri.match(re)) {
          return uri.replace(re, '$1' + key + "=" + value + '$2');
      } else {
          return uri + separator + key + "=" + value;
      }
  }
</script>

{% endblock %}
